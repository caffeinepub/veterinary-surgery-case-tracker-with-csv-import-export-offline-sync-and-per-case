{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Remove legacy case-loading calls and ensure Live redeploy uses fresh backend bindings",
  "requirements": [
    {
      "id": "REQ-3",
      "summary": "Eliminate any remaining frontend runtime call paths to deprecated `getAllSurgeryCases()` and ensure CaseList loads via paginated `getSurgeryCases(start, limit)` only.",
      "acceptanceCriteria": [
        "A repo-wide search (excluding generated declarations) finds no references to `getAllSurgeryCases` under `frontend/src`.",
        "Case loading in `CaseList.tsx` uses the existing store/query path that ultimately calls `actor.getSurgeryCases(start, limit)` and not `getAllSurgeryCases()`.",
        "The live error banner 'Server Cases Loading Failed' no longer appears due to a missing/removed backend method when the user is authenticated and attempts to load server cases."
      ],
      "file_operations": [
        {
          "path": "frontend/src/components/cases/CaseList.tsx",
          "operation": "modify",
          "description": "Inspect and adjust CaseList wiring to ensure it relies exclusively on `useCasesStore()` for server case loading/refetch and does not directly or indirectly trigger any legacy `getAllSurgeryCases()` call paths."
        },
        {
          "path": "frontend/src/hooks/useCasesStore.ts",
          "operation": "modify",
          "description": "Verify the store’s server-fetch integration uses `useGetSurgeryCasesPaginated()` and that refetch flows (including the error-banner retry) cannot hit any legacy case-loading method."
        },
        {
          "path": "frontend/src/hooks/useQueries.ts",
          "operation": "modify",
          "description": "Confirm `useGetSurgeryCasesPaginated()` only calls `actor.getSurgeryCases(start, limit)` and remove/replace any lingering legacy references if present; keep the query key behavior compatible with `useCasesStore()`."
        },
        {
          "path": "frontend/src/hooks/useSync.ts",
          "operation": "modify",
          "description": "Confirm sync’s pagination helper uses only `actor.getSurgeryCases(start, limit)` and remove/replace any lingering legacy references if present (to prevent alternate runtime call paths)."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Ensure the Live frontend redeploy flow regenerates and verifies fresh backend TypeScript bindings that do not include `getAllSurgeryCases`.",
      "acceptanceCriteria": [
        "`frontend/src/declarations/backend/backend.did.d.ts` (generated from the deployed backend) does not contain `getAllSurgeryCases`.",
        "After redeploying the frontend with fresh bindings, the Live site loads server cases successfully (no backend-method-missing error), and the retry action in the error banner is no longer needed for the legacy-method failure scenario."
      ],
      "file_operations": [
        {
          "path": "frontend/scripts/clean-rebuild-frontend.sh",
          "operation": "modify",
          "description": "Harden the deterministic clean rebuild checks so regeneration of bindings is mandatory and the script fails fast if generated bindings include `getAllSurgeryCases`, ensuring stale bindings cannot ship to Live."
        },
        {
          "path": "frontend/redeploy.sh",
          "operation": "modify",
          "description": "Ensure redeploy runs the clean rebuild flow that regenerates bindings before deploying the frontend, and keeps the output/summary steps aligned with verifying the current deployed backend interface."
        },
        {
          "path": "frontend/DEPLOYMENT_NOTES.md",
          "operation": "modify",
          "description": "Update redeploy guidance to explicitly require the clean rebuild + binding verification steps for Live deployments, including confirming bindings do not include `getAllSurgeryCases`."
        },
        {
          "path": "frontend/scripts/verify-live-backend-binding.md",
          "operation": "modify",
          "description": "Update the Live verification checklist to include confirming the regenerated `frontend/src/declarations/backend/backend.did.d.ts` omits `getAllSurgeryCases` and that server cases load without the legacy-method-missing failure."
        }
      ]
    }
  ]
}
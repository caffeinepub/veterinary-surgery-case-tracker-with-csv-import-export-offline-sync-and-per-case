{
  "kind": "build_request",
  "title": "Fix Quick Add Demographics not extracting patient information",
  "projectName": "Surgery Case Tracker",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Fix the Quick Add Demographics paste handler so demographics extraction reliably runs on pasted content and correctly populates the CaseForm fields.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "quick add demographics is not extracting patient information"
        ]
      },
      "acceptanceCriteria": [
        "When the user pastes text into the \"Quick Add Demographics\" textarea, extraction runs and the form auto-fills any eligible fields (MRN, Pet Name, Owner Last Name, Species, Breed, Sex, Date of Birth) based on the pasted text.",
        "Extraction must not depend on reading clipboardData asynchronously after the paste event (i.e., it must still work even if the paste event object is no longer valid).",
        "The pasted text must remain visible in the Quick Add Demographics textarea after paste, and the user can still edit it normally."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Improve the demographics extraction rules to better match common real-world pasted demographics formats so that patient information is extracted more consistently.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "quick add demographics is not extracting patient information"
        ]
      },
      "acceptanceCriteria": [
        "Extraction correctly handles pet/patient names that include mixed case and common characters (e.g., hyphen/apostrophe) instead of only matching a single lowercase token.",
        "Extraction correctly handles MRN/record identifiers that may include prefixes and separators (e.g., \"MRN: A-12345\").",
        "Extraction does not overwrite fields in the CaseForm that the user has already touched, consistent with the existing touchedFields behavior in CaseForm."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add clear user-facing feedback when no usable demographics can be extracted from the pasted text.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-6"
        ],
        "quotes": [
          "quick add demographics is not extracting patient information"
        ]
      },
      "acceptanceCriteria": [
        "If the user pastes text and extraction yields no fields, show a non-blocking message (e.g., toast) indicating that no demographics were detected.",
        "If at least one field is auto-filled, the existing success feedback remains (or equivalent) and indicates how many fields were filled."
      ]
    }
  ],
  "constraints": [
    "Do not edit any files under frontend/src/components/ui (Shadcn components are read-only and must be composed, not modified).",
    "Do not modify frontend immutable paths listed in SYSTEM_CONTEXT (e.g., frontend/src/hooks/useInternetIdentity.ts(x), frontend/src/hooks/useActor.ts, frontend/src/main.tsx)."
  ],
  "nonGoals": [
    "Adding OCR/image-based demographics extraction.",
    "Adding backend parsing or storing additional extracted fields beyond what the CaseForm already supports.",
    "Integrating third-party parsing services or AI extraction."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}
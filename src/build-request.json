{
  "kind": "build_request",
  "title": "Run deterministic clean rebuild and redeploy to fix Live backend disconnected error",
  "projectName": "Surgery Case Tracker",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-4",
      "text": "Perform a deterministic clean rebuild of the frontend to eliminate stale artifacts and regenerate TypeScript backend bindings from the currently deployed backend canister, using the existing script `frontend/scripts/clean-rebuild-frontend.sh`.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "run the clean rebuild again"
        ]
      },
      "acceptanceCriteria": [
        "Running `bash frontend/scripts/clean-rebuild-frontend.sh` completes successfully without errors.",
        "`frontend/src/declarations/backend/backend.did.d.ts` exists after the rebuild.",
        "The generated bindings file does not contain the legacy method `getAllSurgeryCases`.",
        "No frontend source files (excluding `frontend/src/declarations` and `node_modules`) reference `getAllSurgeryCases`.",
        "`frontend/dist` is rebuilt as part of the script run."
      ]
    },
    {
      "id": "REQ-5",
      "text": "Redeploy the frontend canister after the clean rebuild so the Live site ships the newly generated backend bindings, using the deterministic redeploy flow in `frontend/redeploy.sh` (or equivalently: run clean rebuild then `dfx deploy frontend`).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "run the clean rebuild again"
        ]
      },
      "acceptanceCriteria": [
        "Running `bash frontend/redeploy.sh` completes successfully without errors.",
        "The redeploy output prints both backend and frontend canister IDs and a Live URL when on mainnet.",
        "The deployed Live frontend no longer shows a backend disconnected error on page load."
      ]
    },
    {
      "id": "REQ-6",
      "text": "After redeploy, verify that the Live frontend is bound to the currently deployed backend canister ID by following `frontend/scripts/verify-live-backend-binding.md` (confirm the frontend is using fresh bindings and the expected backend canister ID).",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "run the clean rebuild again"
        ]
      },
      "acceptanceCriteria": [
        "The backend canister ID reported by `dfx canister id backend` matches the backend canister ID the Live frontend is effectively using (per the verification guide).",
        "A hard refresh of the Live site loads successfully and backend-dependent UI (e.g., initial connection check) indicates connected/online rather than disconnected."
      ]
    }
  ],
  "constraints": [
    "Do not modify files under the frontend immutable paths listed in SYSTEM_CONTEXT (compose existing components/hooks instead of editing them, if changes become necessary).",
    "Respect the single-actor backend architecture; do not introduce additional backend services."
  ],
  "nonGoals": [
    "Adding new product features beyond fixing the frontendâ†”backend binding/deployment mismatch.",
    "Changing backend interface/schema unless the clean rebuild scripts reveal a backend export mismatch that must be addressed separately."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}